---
title: 漏洞原理
date: 2021-12-30 12:45:18
tags:
---
# 安全面试大合集
## 计算机网络

## 操作系统

## OWASP TOP 10
- 失效的访问控制
- 加密失败
- 注入
- 不安全的设计
- 安全配置错误
- 易受攻击和过时的组件
- 认证和授权失败
- 软件和数据完整性故障
- 安全日志记录和监控失败
- 服务器请求伪造

# WAF
## WAF产品
- 安全狗
## WAF简介
- WAF(Web应用防火墙)是通过执行一系列针对HTTP/HTTPS的安全策略来专门为Web应用提供保护的一款产品。通俗来说就是WAF产品里集成了一定的检测规则，会对每个请求的内容根据生成的规则进行检测并对不符合安全规则的作出对应的防御处理，从而保证Web应用的安全性与合法性。
## WAF工作原理
1. 预处理：预处理阶段首先在接收到数据请求流量时会先判断是否为HTTP/HTTPS请求，之后会查看此URL请求是否在白名单之内，
2. 规则检测
3. 处理模块
4. 日志记录
## WAF的分类
1. 软WAF
2. 硬WAF
3. 云WAF
4. 自定义WAF
## WAF的部署方式
1. 透明网桥
2. 反向代理
3. 镜像流量
4. 路由代理
## 绕过WAF方式
1. URL编码绕过
2. 字母大小写绕过
3. 空格过滤绕过
4. 双写绕过
5. 内联注释绕过
6. 请求方式差异规则松懈性绕过
7. 异常Method绕过
8. 超大数据包绕过
9. 复参数绕过
10. 添加%绕过
11. 协议未覆盖绕过
12. 宽字节绕过
13. %00截断
14. Cookie/X-Forwaded-For注入绕过
15. 利用pipline绕过
16. 利用分块编码传输绕过
17. 冷门函数/字符/运算符绕过
## 代码审计工具
- Fortify SCA(静态、白盒)
- Checkmarx CxSuite()
- 360代码卫士
## 渗透测试步骤
1. 信息收集
2. 漏洞探测
3. 漏洞利用
4. 内网转发
5. 内网渗透
6. 痕迹清除
## 常见漏洞
### SQL注入
#### 攻击原理
- 攻击者构造的恶意代码没有进行参数合法性校验，导致被带入数据库执行;
#### 防护手段
- 不用拼接SQL字符串
- 使用预编译的Preparement
- 使用WAF防火墙
- 过滤输入的关键字
### XSS注入
#### 攻击原理
- 攻击者通过将代码注入被攻击者的网站中，用户一旦访问网页就会执行被注入的恶意脚本。
#### XSS分类
- 反射型XSS
- 存储型XSS
- DOM型XSS
#### XSS防护
- 对script关键字进行过滤
- HTML实体转义
- XSS保护头

### 命令执行漏洞
#### 攻击原理
- 在操作系统中,"&、|、||"可以作为命令连接符使用，用户通过浏览器提交执行命令，由于服务器端没有针对执行函数做过滤，将用户的输入作为系统命令的参数拼接到命令行中，在没有过滤用户输入的情况下，造成命令执行漏洞。
#### 防护手段
- 进入命令执行的函数或者方法之前，对参数进行过滤
- 参数的值尽量用引号包裹(单引号变量不解系)，并在拼接前调用addslashes进行转义
- 禁止能执行系统命令的函数，可在php的配置文件中设置disable_functions

### 代码执行漏洞
#### 攻击原理
- 应用程序在调用一些能够将字符串转换为代码的函数(如PHP中的eval(),eval可以将字符串当作函数进行执行)时，没有考虑用户是否控制这个字符串，将造成代码执行漏洞。
#### 防护手段
- 保证用户不能轻易接触eval()函数的参数或者用正则严格判断输入的数据格式
- 字符串使用单引号包裹，并在插入前进行addslashes()
- 对preg_replace()放弃使用修饰服，保证第二个参数中对于正则匹配出的对象，用单引号包裹
### 文件上传漏洞
#### 防护手段
- 客户端检测，使用js对上传图片检测，包括文件大小、文件扩展名、文件类型等
- 服务端检测，对文件大小、文件路径、文件扩展名、文件类型、文件内容检测、对文件重命名等
- 服务器端上传目录设置不可执行权限
- 检查网站有没有文件解析漏洞和文件包含漏洞
- 将文件上传到单独的文件服务器，并且单独设置文件服务器的域名

### CSRF跨站请求伪造
#### CSRF跨站请求伪造攻击原理
- 攻击盗用被攻击者的身份来对服务器发送恶意请求
### SSRF(服务端请求伪造)
#### SSRF攻击原理
- 是一种由攻击者构造请求由服务器端发起请求的安全漏洞，本质上是属于信息泄漏漏洞。

### XXE(外部实体注入)
#### XXE漏洞原理
- 当允许引用外部实体时，可通过构造恶意的XML内容，导致读取任意文件、执行系统命令、探测内网端口、攻击内网网站等后果；
### 什么是Java序列化
- Java 序列化是指把 Java 对象转换为字节序列的过程便于保存在内存、文件、数据库中，ObjectOutputStream类的 writeObject() 方法可以实现序列化。
### 什么是Java反序列化
- Java 反序列化是指把字节序列恢复为 Java 对象的过程，ObjectInputStream 类的 readObject() 方法用于反序列化。
## 业务逻辑漏洞
### 安全逻辑
- 查看能否绕过判定重新安装
- 查看能否利用安装文件获取信息
- 查看能否利用更新功能获取信息
### 交易
#### 购买
- 修改支付的价格
- 修改支付的状态
- 修改购买数量为负数
- 修改金额为负数
- 重放成功的请求
- 并发数据库锁处理不当
#### 业务风控
- 刷优惠券
- 套现
### 账户
#### 注册
- 覆盖注册
- 尝试重复用户名
- 注册遍历猜解已有帐号
#### 密码
- 密码未使用哈希算法保存
等等[链接](https://websec.readthedocs.io/zh/latest/vuln/logic.html)
